functions:
  - name: atan2
    signature: "`atan2(x, y)`"
    description: Return the inverse tangent of `x`/`y` in radians between -pi and pi.
    examples:
      - atan2(3, 2) -> 0.982793723247329

  - name: case
    signature: "`case(x, c1, r1, c2, r2, ..., (default))`"
    description: |
      Compare `x` to each of `c1`, `c2`, etc. and return the matching `r1`, `r2` of the first match. If no entry matches, a final optional expression can be returned as default.
    examples:
      - case("b", "a", 1, "b", 2, "c", 3, 0) -> 2
      - case("d", "a", 1, "b", 2, "c", 3, 0) -> 0

  - name: ceil
    signature: "`ceil(x)`"
    description: Return `x` rounded up to the nearest integer.
    examples:
      - ceil(16.2) -> 17

  - name: chunk
    signature: "`chunk(x, s)`"
    description: Convert the list `x` into several lists of length at most `s`
    examples:
      - chunk([1, 2, 3, 4, 5, 6, 7], 3) -> [[1, 2, 3], [4, 5, 6], [7]]

  - name: concat
    signature: "`concat(x, y, ...)`"
    description: Concatenate any number of strings.
    examples:
      - concat("Hello, ", "world!") -> "Hello, world!"
      - |
        {
            "externalId": concat("some-prefix:", input.tag)
        }

  - name: distinct_by
    signature: "`distinct_by(x, (a(, b)) => ...)`"
    description: Return a list or object where the elements are distinct by the returned value of the given lambda function. The lambda function either takes list values, or object (value, key) pairs.
    examples:
      - "[1, 2, 3, 4, 5].distinct_by(x => x % 2) -> [1, 2]"

  - name: except
    signature: "`except(x, (v(, k)) => ...)` or `except(x, l)`"
    description: |
      Return a list or object where keys or entries maching the predicate have been removed.
      If the second argument is a lambda, it will be given the entry and if it returns `true`, the entry is removed.
      If the second argument is a list, any entry also found in this list will be removed.
    examples:
      - |
        {
            "x-axis": 13.6,
            "y-axis": 63.1,
            "z-axis": 1.4,
            "offset": 4.3,
            "power": "on"
        }.except(["offset", "power"])
        ->
        {
            "x-axis": 13.6,
            "y-axis": 63.1,
            "z-axis": 1.4
        }
      - |
        {
            "a": 1,
            "b": 2,
            "c": 3,
            "d": 4
        }.except((v, k) => v > 2)
        ->
        {
            "a": 1,
            "b": 2
        }

  - name: filter
    signature: "`filter(x, it => ...)`"
    description: Remove any item from the list `x` where the lambda function returns `false` or `null`.
    examples:
      - "[1, 2, 3, 4].filter(item => item > 2) -> [3, 4]"
      - |
        input.data.map(row => {
            "timestamp": to_unix_timestamp(row.StartTime, "%Y-%m-%dT%H:%M:%S"),
            "value": try_float(row.Value, null),
            "externalId": concat("prefix/", column.Name),
            "type": "datapoint",
        }).filter(dp => dp.value is "number")

  - name: flatmap
    signature: "`flatmap(x, it => ...)`"
    description: |
      Apply the lambda function to every item in the list `x` and flattens the result.

      For example, if the lambda function returns a list, the result of the `flatmap` will just be a list instead of a list of lists.
    examples:
      - |
        [[1, 2, 3], [2, 3, 4], [3, 4, 5]].flatmap(list => list.map(item => item + 1))
        ->
        [2, 3, 4, 3, 4, 5, 4, 5, 6]
      - |
        input.sensorData.flatmap(timeseries =>
            timeseries.values.map(datapoint => {
                "value": datapoint.value,
                "timestamp": to_unix_timestamp(datapoint.datetime, "%Y-%m-%dT%H:%M:%S"),
                "externalId": concat(timeseries.location, "/", timeseries.sensor),
                "type": "datapoint"
            })
        )

  - name: float
    signature: "`float(x)`"
    description: |
      Convert `x` into a floating point number if possible. If the conversion fails, the whole mapping will fail.

      Consider using [try_float](#try_float) instead if you need error handling.
    examples:
      - float("6.1") -> 6.1

  - name: floor
    signature: "`floor(x)`"
    description: Return `x` rounded down to the nearest integer.
    examples:
      - floor(16.2) -> 16

  - name: format_timestamp
    signature: "`format_timestamp(x, f)`"
    description: |
      Convert the Unix timestamp `x` into a string representation based on the format `f`.

      The format is given using the table found [here](https://docs.rs/chrono/latest/chrono/format/strftime/index.html).
    examples:
      - format_timestamp(1694159249120, "%Y-%m-%d %H:%M:%S") -> "2023-09-08 07:47:29"
      - format_timestamp(now(), "%d/%m - %Y") -> "08/09 - 2023"

  - name: if
    signature: "`if(x, y, (z))`"
    description: Return `y` if `x` evaluates to `true`, otherwise return `z`, or `null` if `z` is omitted.
    examples:
      - if(condition, "yes", "no")
      - if(true, "on", "off") -> "on"

  - name: int
    signature: "`int(x)`"
    description: |
      Convert `x` into an integer if possible. If the conversion fails, the whole mapping will fail.

      Consider using [try_int](#try_int) instead if you need error handling.
    examples:
      - int("6") -> 6

  - name: join
    signature: "`join(a, b, ...)`"
    description: Return the union of the given objects or arrays. If a key is present in multiple objects, each instance of the key is overwritten by later objects. Arrays are simply merged.
    examples:
      - |
        join({"key1": "value1"}, {"key2": "value2"})
        ->
        {
            "key1": "value1",
            "key2": "value2"
        }
      - |
        join([1, 2, 3], [4, 5], [6, 7, 8])
        ->
        [1, 2, 3, 4, 5, 6, 7, 8]

  - name: length
    signature: "`length(x)`"
    description: Return the length on the list, string or object `x`.
    examples:
      - length("Hello, world") -> 12
      - length([1, 2, 3]) -> 3
      - length(input.items)

  - name: log
    signature: "`log(x, y)`"
    description: Return the base `y` logarithm of `x`.
    examples:
      - log(16, 2) -> 4.0

  - name: map
    signature: "`map(x, (it(, index)) => ...)`"
    description: |
      Apply the lambda function to every item in the list `x`. The lambda takes an optional second input which is the index of the item in the list.

      If applied to an object, the first input is the value, and the second is the key. The result is the new value.

      If the value is `null`, the lambda is ignored and `map` returns `null`.
    examples:
      - "[1, 2, 3, 4].map(number => number * 2) -> [2, 4, 6, 8]"
      - |
        input.data.map(item => {
            "type": "datapoint",
            "value": item.value,
            "externalId": concat("prefix:", item.tag),
            "timestamp": now()
        })
      - |
        ["a", "b", "c"].map((item, index) => index)
        ->
        [1, 2, 3]
      - |
        {"a": 1, "b": 2, "c": 3}.map((value, key) => concat(value, key))
        ->
        {"a": "1a", "b": "2b", "c": "3c"}

  - name: now
    signature: "`now()`"
    description: Return the current time as a millisecond Unix timestamp, that is, the number of milliseconds since midnight 1/1/1970 UTC.
    examples:
      - |
        {
            "timestamp": now()
        }

  - name: pairs
    signature: "`pairs(x)`"
    description: Convert the object `x` into a list of key/value pairs.
    examples:
      - |
        {
            "a": 1,
            "b": 2,
            "c": 3
        }.pairs()
        ->
        [{
            "key": "a",
            "value": 1
        }, {
            "key": "b",
            "value": 2
        }, {
            "key": "c",
            "value": 3
        }]
      - |
        {
            "x-axis": 12.4,
            "y-axis": 17.3,
            "z-axis": 2.1
        }.pairs().map(kv => {
            "timestamp": now(),
            "value": kv.value,
            "externalId": kv.key,
            "type": "datapoint"
        })

  - name: pow
    signature: "`pow(x, y)`"
    description: Return `x` to the power of `y`
    examples:
      - pow(5, 3) -> 125.0

  - name: reduce
    signature: "`reduce(x, (acc, val) => ..., init)`"
    description: Return the value obtained by reducing the list `x`. The lambda function is called once for each element in the list `val`, and the returned value is passed as `acc` in the next iteration. The `init` will be given as the initial `acc` for the first call to the lambda function.
    examples:
      - "[1, 2, 3, 4, 5].reduce((acc, val) => acc + val, 0) -> 15"
      - "[1, 2, 3, 4, 5].reduce((acc, val) => acc * val, 1) -> 120"

  - name: round
    signature: "`round(x)`"
    description: Return `x` rounded to the nearest integer.
    examples:
      - round(16.2) -> 16

  - name: select
    signature: "`select(x, (v(, k)) => ...)` or `select(x, [1, 2, 3])`"
    description: Return a list or object where the lambda returns true. If the second argument is a list, the list values or object keys found in that list are used to select from the source.
    examples:
      - |
        {
            "x-axis": 13.6,
            "y-axis": 63.1,
            "z-axis": 1.4,
            "offset": 4.3,
            "power": "on"
        }.select(["x-axis", "y-axis", "z-axis"])
        ->
        {
            "x-axis": 13.6,
            "y-axis": 63.1,
            "z-axis": 1.4
        }
      - |
        {
            "a": 1,
            "b": 2,
            "c": 3
        }.select((v, k) => v > 2)
        ->
        {
            "c": 3
        }

  - name: string
    signature: "`string(x)`"
    description: |
      Convert `x` into a string.

      `null`s will be converted into empty strings.
    examples:
      - string(true) -> "true"

  - name: sum
    signature: "`sum(x)`"
    description: |
      Sum the numbers in the array `x`.
    examples:
      - '[1, 2, 3, 4].sum()
        ->
        10'

  - name: to_object
    signature: "`to_object(x, val => ...(, val => ...))`"
    description: |
      Convert the array `x` into an object by producing the key and value from two lambdas.

      The first lambda produces the key, and the second (optional) produces the value. If the second is
      left out, the input is used as a value directly.
    examples:
      - '[1, 2, 3].to_object(v => string(v + 1))
        ->
        { "2": 1, "3": 2, "4": 3 }'
      - '[1, 2, 3].to_object(v => string(v + 1), v => v - 1)
        ->
        { "2": 0, "3": 1, "4": 2 }'
      - '{"a": 1, "b": 2, "c": 3}.pairs().to_object(pair => pair.key, pair => pair.value)
        ->
        {"a": 1, "b": 2, "c": 3}'

  - name: to_unix_timestamp
    signature: "`to_unix_timestamp(x, f)`"
    description: |
      Convert the string `x` into a millisecond Unix timestamp using the format string `f`.

      The format is given using the table found [here](https://docs.rs/chrono/latest/chrono/format/strftime/index.html).
    examples:
      - to_unix_timestamp("2023-05-01 12:43:23", "%Y-%m-%d %H:%M:%S") -> 1682945003000
      - |
        {
            "timestamp": to_unix_timestamp(input.time, "%Y-%m-%d %H:%M:%S")
        }

  - name: try_bool
    signature: "`try_bool(a, b)`"
    description: Try convert `a` to a boolean, if it fails, return `b`.
    examples:
      - try_bool("true", null) -> true
      - try_bool("foo", null) -> null

  - name: try_float
    signature: "`try_float(a, b)`"
    description: Try convert `a` to a float, if it fails, return `b`.
    examples:
      - try_float("6.2", 1.2) -> 6.2
      - try_float("4,5", null) -> 4.5

  - name: try_int
    signature: "`try_int(a, b)`"
    description: Try convert `a` to a int, if it fails, return `b`.
    examples:
      - try_int("6", 1) -> 6
      - try_int("4", null) -> 4

  - name: zip
    signature: "`zip(x, y, ..., (i1, i2, ...) => ...)`"
    description: Take a number of arrays, call the given lambda function on each entry, and return a single array from the result of each call. The returned array will be as long as the longest argument, null will be given for the shorter input arrays when they run out.
    examples:
      - 'zip([1, 2, 3], ["a", "b", "c"], (a, b) => concat(a, b))
        ->
        ["1a", "2b", "3c"]'

  - name: substring
    signature: "`substring(x, start(, end))`"
    description: "Create a substring of an input string `x` from `start` to `end`. If `end` is not specified, go from `start` to end of string. If `start` or `end` are negative, count from the end of the string."
    examples:
      - '"hello world".substring(3, 8)
        ->
        "lo wo"'
      - '"hello world".substring(0, -3)
        ->
        "hello wo"'


  - name: tail
    signature: "`tail(x(, n))`"
    description: "Take the last element of the list `x`. If `n` is given, takes the last `n` elements, and returns a list if `n` > 1."
    examples:
      - "[1, 2, 3, 4, 5].tail() -> 5"
      - "[1, 2, 3, 4, 5].tail(2) -> [4, 5]"

  - name: split
    signature: "`split(a, b)`"
    description: "Split string `a` on any occurences of `b`. If `b` is an empty string, this will split on each character, including before the first and after the last."
    examples:
      - '"hello world".split(" ")
        ->
        ["hello", "world"]'
      - '"hello".split("")
        ->
        ["", "h", "e", "l", "l", "o", ""]'

  - name: trim_whitespace
    signature: "`trim_whitespace(x)`"
    description: "Remove any whitespace from the start and end of `x`"
    examples:
      - '"  hello   ".trim_whitespace() -> "hello"'

  - name: slice
    signature: "`slice(x, start(, end))`"
    description: Create a sub-array from an array `x` from `start` to `end`. If `end is not specified, go from `start` the end of the array. If `start` or `end` are negative, count from the end of the array.
    examples:
      - '[1, 2, 3, 4].slice(1, 3)
        ->
        [2, 3]'
      - '[1, 2, 3, 4].slice(0, -3)
        ->
        [1]'

  - name: chars
    signature: "`chars(x)`"
    description: Create an array of characters from a string.
    examples:
      - '"test".chars() -> ["t", "e", "s", "t"]'

  - name: replace
    signature: "`replace(a, b, c)`"
    description: "Replaces a string with another string"
    examples:
      - '"tomato".replace("tomato","potato")
        -> "potato"'
      - 'replace("potato","o","a")
        -> "patata"'

  - name: any
    signature: "`any(x)`"
    description: Return `true` if any items in the array `x` is true.
    examples:
     - "[true, false, false, true].any() -> true"
     - "[false, false, false, false].any() -> false"

  - name: all
    signature: "`all(x)`"
    description: Return `true` if all items in the array `x` is true.
    examples:
     - "[true, false, false, true].all() -> false"
     - "[true, true, true, true].all() -> true"

  - name: contains
    signature: "`contains(x, a)`"
    description: Return `true` if the array or string `x` contains item `a`.
    examples:
     - "[1, 2, 3, 4].contains(4) -> true"
     - '"hello world".contains("llo wo") -> true'

  - name: string_join
    signature: "`string_join(x(, a))`"
    description: Return a string with all the elements of `x`, separated by `a`. If `a` is omitted, the strings will be joined without any separator.
    examples:
     - '["hello", "there"].string_join(" ") -> "hello there"'
     - '[1, 2, 3].string_join() -> "123"'

  - name: min
    signature: "`min(a, b, ...)`"
    description: Returns the smaller of the given numbers. Can also be used on an array.
    examples:
     - 'min(1, 2) -> 1'
     - 'min(1, 5, 2.0, 6) -> 1.0'
     - '[1, 8, 9, 2, 5, 4].min() -> 1'

  - name: max
    signature: "`max(a, b, ...)`"
    description: Returns the larger of the given numbers. Can also be used on an array.
    examples:
     - 'max(1, 2) -> 2'
     - 'max(1, 5, 2.0, 6) -> 6.0'
     - '[1, 8, 9, 2, 5, 4].max() -> 9'

  - name: digest
    signature: "`digest(a, b, ...)`"
    description: Compute the SHA256 hash of the list of values.
    examples:
      - 'digest("foo", "bar", 123, [1, 2, 3]) -> lDN5G9Qz3fKZM6joQq+1OdF8P1rs2WYrgawlFXflqss='

  - name: coalesce
    signature: "`coalesce(a, b, ...)`"
    description: Return the first non-null value in the list of values.
    examples:
      - 'coalesce(null, "a", "b") -> "a"'

  - name: regex_is_match
    signature: "`regex_is_match(haystack, regex)`"
    description:
      Return `true` if the haystack matches the regex.
      Prefer this over the other regex methods if you only need to check for the presence of a match.

      We support a limited form of regex without certain complex features, such as
      backreferences and look-around. See [all the available regex syntax](https://docs.rs/regex/1.11.0/regex/index.html#syntax).
      We recommend using [regex101](https://regex101.com/) with the mode set to `rust` for debugging regex.
    examples:
      - 'regex_is_match("test", "te") -> true'
      - 'regex_is_match("test", "^not test$") -> false'

  - name: regex_first_match
    signature: "`regex_first_match(haystack, regex)`"
    description:
      Return the first substring in the haystack that matches the regex. If no match is found,
      this returns `null`. Prefer [regex_is_match](#regex_is_match) if all you need is to check
      for the existence of a match.

      See [regex_is_match](#regex_is_match) for details on regex support.
    examples:
      - 'regex_first_match("test", "te") -> "te"'
      - 'regex_first_match("te[st]{2}") -> "test"'

  - name: regex_all_matches
    signature: "`regex_all_matches(haystack, regex)`"
    description:
      Return an array of all the substrings that match the regex. If no match is found,
      this returns an empty array. If you only need the first match, use [regex_first_match](#regex_first_match).

      See [regex_is_match](#regex_is_match) for details on regex support.
    examples:
      - 'regex_all_matches("tests", "t[a-z]") -> ["te", "ts"]'
      - 'regex_all_matches("foo bar baz", "\\w{3}") -> ["foo", "bar", "baz"]'
      - 'regex_all_matches("test", "not test") -> []'

  - name: regex_first_captures
    signature: "`regex_first_captures(haystack, regex)`"
    description:
      Return an object containing all capture groups from the first match of the regex in the haystack.
      Unnamed capture groups are named after their index, so the match itself is always included as
      capture group `0`. If no match is found, this returns null.

      See [regex_is_match](#regex_is_match) for details on regex support.
    examples:
      - 'regex_first_captures("test foo bar", "test (?<v1>\\w{3}) (\\w{3})")
        ->
        {
          "0": "test foo bar",
          "v1": "foo",
          "2": "bar"
        }'
  - name: regex_all_captures
    signature: "`regex_all_captures(haystack, regex)`"
    description:
      Return an array of objects containing all capture groups from each match of the regex in the haystack.
      Unnamed capture groups are named after their index, so the match itself is always included as
      capture group `0`. If no match is found, this returns an empty array.

      See [regex_is_match](#regex_is_match) for details on regex support.
    examples:
      - 'regex_all_captures("f123 f45 ff", "f(?<v>[0-9]+)")
        ->
        [{
          "0": "f123",
          "v": "123"
        }, {
          "0": "f45",
          "v": "45"
        }]
      '
  - name: regex_replace
    signature: "`regex_replace(haystack, regex, replace)`"
    description:
      Replace the first occurrence of the regex in the haystack. The replace object supports referencing
      capture groups using either the index (`$1`) or the name (`$group`). Use `$$` if you need a literal
      `$` symbol. `${group}` is equivalent to `$group` but lets you specify the group name exactly.

      See [regex_is_match](#regex_is_match) for details on regex support.
    examples:
      - 'regex_replace("test", "te(?<v>[st]{2})", "fa$v") -> "fast"'
  - name: regex_replace_all
    signature: "`regex_replace_all(haystack, regex, replace)`"
    description:
      Replace each occurrence of the regex in the haystack. See [regex_replace](#regex_replace) for
      details.
    examples:
      - 'regex_replace_all("tests", "t(?<v>[se])", "${v}t") -> etsst'

  - name: starts_with
    signature: "`starts_with(item, substring)`"
    description:
      Return `true` if `item` starts with `substring`.
    examples:
      - '"hello world".starts_with("hello") -> true'

  - name: ends_with
    signature: "`ends_with(item, substring)`"
    description:
      Return `true` if `item` ends with `substring`.
    examples:
      - '"hello world".ends_with("world") -> true'

  - name: if_value
    signature: "`if_value(item, item => ...)`"
    description:
      Map a value using a lambda if the value is not null. This is useful if you need to combine
      parts of some complex object or result of a longer calculation.
    examples:
      - '"hello".if_value(a => concat(a, " world")) -> "hello world"'
      - 'null.if_value(a => a + 1) -> null'
      - '[1, 2, 3].if_value(a => a[0] + a[1] + a[2]) -> 6'

  - name: parse_json
    signature: "`parse_json(string)`"
    description:
      Parse a string as a JSON object, which can be used in further transformations.
      If the passed value isn't a string, it's returned as-is.
    examples:
      - 'parse_json("{\"a\": 1, \"b\": 2}") -> {"a": 1, "b": 2}'

  - name: lower
    signature: "`lower(x)`"
    description: Convert all characters in the string `x` to lowercase. If `x` is a boolean or number, it will be converted to a string.
    examples:
      - '"Hello World".lower() -> "hello world"'
